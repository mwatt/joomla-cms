<jos:comment>
@version $Id$
@package Joomla
@subpackage Installation
@copyright Copyright (C) 2005 Open Source Matters. All rights reserved.
@license http://www.gnu.org/copyleft/gpl.html GNU/GPL
</jos:comment>
<script language="JavaScript" type="text/javascript">
function validateForm( frm, task ) {
	var DBtype = getElementByName( frm, 'vars[DBtype]' );
	var DBhostname = getElementByName( frm, 'vars[DBhostname]' );
	var DBname = getElementByName( frm, 'vars[DBname]' );

	if ( DBtype.selectedIndex == 0 ) {
		alert( '<jos:translate key="validType" escape="yes">Please select the database type</jos:translate>' );
		return;
	} else if (DBhostname.value == '') {
		alert( '<jos:translate key="validHost" escape="yes">Please enter the host name</jos:translate>' );
		return;
	} else if (!document.getElementById('vars_dbcollation')) {
		alert( '<jos:translate key="validCollation" escape="yes">Please choose a database collation</jos:translate>' );
		return;
	} else if (DBname.value == '') {
		alert( '<jos:translate key="validName" escape="yes">Please enter a database name</jos:translate>' );
		return;
	} else {
		submitForm( frm, task );
	}
}

function getReturnData( data , statusCode , statusMessage) {
	//AJFORM failed. Submit form normally.
	if( statusCode != AJForm.STATUS['SUCCESS'] ) {
		alert( statusMessage );
		return true;
	}
	//AJFORM succeeded.
	else {
		if (data.indexOf("jos-Error") > 0) {
			alert(data.replace(/(<([^>]+)>)/ig,""));
		} else {

			var tc = document.getElementById("theCollation");
			var cm = document.getElementById("collationMessage");
			var utf = document.getElementById("utfsupport");
			
			var split = data.indexOf("\n");

			if (data.substr(0, split) == "true") {
				cm.innerHTML = '<jos:translate key="tipCollationUtf" escape="yes"><p>This version of MySQL includes UTF-8 support which is the required encoding.</p><p>Choose a collation from the list. If none appears for your language, that is because the default collation <em>utf8_general_ci</em> is suitable.</p></jos:translate>';
				utf.value = 1;
			} else {
				cm.innerHTML = '<jos:translate key="tipCollationNonUtf" escape="yes"><p>This version of MySQL does not have UTF-8 support which is the required encoding.</p><p>It is recommended that you upgrade your database to a version newer than 4.1.2. If this is not possible, Joomla! will store utf-8 encoded content in your existing database in a backward compatibility mode. Collation selection is not possible in this mode and a default collation will be used.</p></jos:translate>';
				utf.value = 0;
			}
	
			tc.innerHTML = data.substr(split + 1);
		}
	}
}
	
function JProcess() {

	var type = document.getElementById("vars_dbtype");
	var host = document.getElementById("vars_dbhostname");
	var user = document.getElementById("vars_dbusername");
	var pass = document.getElementById("vars_dbpassword");
	var ajtype = document.getElementById("theType");
	var ajhost = document.getElementById("theHost");
	var ajuser = document.getElementById("theUser");
	var ajpass = document.getElementById("thePass");
	var thisForm = document.getElementById( 'mainForm' );
	
	if ( type.selectedIndex == 0 ) {
		alert( '<jos:translate key="validType" escape="yes">Please select the database type</jos:translate>' );
		return;
	} else if (host.value == '') {
		alert( '<jos:translate key="validHost" escape="yes">Please enter the host name</jos:translate>' );
		return;
	} else if (user.value == '') {
		alert( '<jos:translate key="validUser" escape="yes">Please enter a database username</jos:translate>' );
		return;
	} else {
		ajtype.value = type.options[type.selectedIndex].value;
		ajhost.value = host.value;
		ajuser.value = user.value;
		ajpass.value = pass.value;
	
		thisForm.ajform_submit();
	}
}
</script>

<form action="index.php" method="post" name="adminForm">
<div id="right">
	<div id="rightpad">
		<div id="step">
			<jos:translate>Database Configuration</jos:translate>
		</div>

		<div class="far-right">
			<input type="button" class="button" value="&lt;&lt; <jos:translate escape="yes">Previous</jos:translate>" onclick="submitForm( this.form, 'license' );" />
			<input type="button" class="button" value="<jos:translate escape="yes">Next</jos:translate> &gt;&gt;" onclick="validateForm( this.form, 'makedb' );" />
		</div>

		<div class="clr"></div>

		<h2>
		<jos:translate>Connection Settings</jos:translate>:
		</h2>

		<div class="install-text">
			<jos:translate key="tipDatabaseSteps">
			<p>Setting up Joomla! to run on your server involves 4 simple steps...</p>
			<p>Please enter the hostname of the server Joomla! is to be installed on.</p>
			<p>Enter the MySQL username, password and database name you wish to use with Joomla.</p>
			<p>Enter a prefix to be used by tables for this Joomla! installation. Select how to handle exisitng tables from a previous installation.</p>
			<p>Install the samples unless you are experienced want to start with a virtually empty site.</p>
			</jos:translate>
		</div>

		<div class="install-form">
			<div class="form-block">
	 			<table class="content2">
	  			<tr>
	    			<td></td>
	    			<td></td>
	    			<td></td>
				</tr>
				<tr>
					<td colspan="2">
						<label for="vars[advanced]">
							<jos:translate>Advanced Mode</jos:translate>
						</label>
						<br/>
						<input class="inputbox" type="checkbox" id="advanced" name="vars[advanced]" value="1" accesskey="a" onChange="toggleAdvanced(this)" />
					</td>
					<td>
		  		    	<em>
		  		    	<jos:translate key="tipAdvanced">Check to enter advanced mode.</jos:translate>
		  		    	</em>
					</td>
				</tr>
	  			<tr>
	    			<td colspan="2">
	    				<label for="vars_dbtype">
	    					<jos:translate>Database Type</jos:translate>
	    				</label>
	    				<br/>
	 					<select id="vars_dbtype" name="vars[DBtype]" class="inputbox" size="1">
						<option value=""><jos:translate>Select Type</jos:translate></option>
						<jos:tmpl name="dbtype-options">
							<option value="{TEXT}" {SELECTED}>{TEXT}</option>
						</jos:tmpl>
						</select>
			   		</td>
		  		    <td>
		  		    	<em>
		  		    	<jos:translate key="tipType">This is probably 'mysql'</jos:translate>
		  		    	</em>
		  		    </td>
				</tr>
	  			<tr>
	    			<td colspan="2">
	    				<label for="vars_dbhostname">

							<jos:translate>Host Name</jos:translate>

						</label>

	    				<br/>

	    				<input id="vars_dbhostname" class="inputbox" type="text" name="vars[DBhostname]" value="{VAR_DBHOSTNAME}" />
	    			</td>
		  		    <td>
		  		    	<em>
		  		    	<jos:translate key="tipHost">This is usually 'localhost'</jos:translate>
		  		    	</em>
		  		    </td>
				</tr>
				<tr>
		  		    <td colspan="2">
	    				<label for="vars_dbusername">
			  		    	<jos:translate>User Name</jos:translate>
						</label>
		  		    	<br/>
		  		    	<input id="vars_dbusername" class="inputbox" type="text" name="vars[DBuserName]" value="{VAR_DBUSERNAME}" />
		  		    </td>
		  		    <td>
		  		    	<em>
		  		    	<jos:translate key="tipUser">Either something as 'root' or a username given by the hoster</jos:translate>
		  		    	</em>
		  		    </td>
				</tr>
		  		<tr>
		  		    <td colspan="2">
	    				<label for="vars_dbpassword">
		  		    		<jos:translate>Password</jos:translate>
						</label>
		  		    	<br/>
		  		    	<input id="vars_dbpassword" class="inputbox" type="text" name="vars[DBpassword]" value="{VAR_DBPASSWORD}" />
		  		    </td>
		  		    <td>
		  		    	<em>
		  		    	<jos:translate key="tipPassword">For site security using a password for the mysql account is mandatory</jos:translate>
		  		    	</em>
		  		    </td>
				</tr>
		  		<tr>
		  		    <td colspan="2" valign="top">
	    				<label for="vars_dbcollation">
		  		    		<jos:translate>Available collations</jos:translate>
						</label>
		  		    	<br/>
		  		    	<span id="theCollation"><input type="button" id="findbutton" class="button" value="Get Collations" onclick="JProcess();" /></span>
		  		    </td>
		  		    <td>
		  		    	<em>
		  		    	<span id="collationMessage">Once you have filled in the database information, click the Get Collations button to get the available collation options from the database</span>
		  		    	</em>
		  		    </td>
				</tr>
	  			<tr>
	    			<td colspan="2">
	    				<label for="vars_dbname">
		    				<jos:translate>Database Name</jos:translate>
						</label>
	    				<br/>
	    				<input id="vars_dbname" class="inputbox" type="text" name="vars[DBname]" value="{VAR_DBNAME}" />
	    			</td>
		  		    <td>
		  		    	<em>
		  		    	<jos:translate key="tipDatabase">Some hosts allow only a certain DB name per site. Use table prefix in this case for distinct Joomla! sites.</jos:translate>
		  		    	</em>
		  		    </td>
				</tr>
	  			<tr>
	    			<td colspan="2">
	    				<label for="vars_dbprefix">
		    				<jos:translate>Table Prefix</jos:translate>
						</label>
	    				<br/>
	    				<input id="vars_dbprefix" class="inputbox" type="text" name="vars[DBPrefix]" value="{VAR_DBPREFIX}" />
	    			</td>
		  		    <td>
		  		    	<em>
		  		    	<jos:translate key="tipPrefix">Dont use 'old_' since this is used for backup tables</jos:translate>
		  		    	</em>
		  		    </td>
				</tr>
	  			<tr id="dbtabledel" style="display:none;">
		  		    <td>
		  		    	<input id="vars_dbdel" type="checkbox" name="vars[DBDel]" value="1" />
		  		    </td>
					<td>
	    				<label for="vars_dbdel">
							<jos:translate>Drop Existing Tables</jos:translate>
						</label>
					</td>
	    			<td></td>
		  		</tr>
	  			<tr id="dbtablebu" style="display:none;">
		  		    <td>
		  		    	<input id="vars_dbbackup" type="checkbox" name="vars[DBBackup]" value="1"  checked="checked"/>
		  		    </td>

					<td>
	    				<label for="vars_dbbackup">
							<jos:translate>Backup Old Tables</jos:translate>
						</label>
					</td>

	    			<td>
	    				<em>
	    				<jos:translate key="tipBackup">Any existing backup tables from former Joomla! installations will be replaced</jos:translate>
	    				</em>
	    			</td>
		  		</tr>
	  			<tr id="dbtablesmpl" style="display:none;">
		  		    <td>
		  		    	<input id="vars_dbsample" type="checkbox" name="vars[DBSample]" value="1" checked="checked"/>
		  		    </td>
					<td>
	    				<label for="vars_dbsample">
							<jos:translate>Install Sample Data</jos:translate>
						</label>
					</td>
		  		    <td>
		  		    	<em>
		  		    	<jos:translate key="tipSample">Uncheck only if you are experienced with Joomla!</jos:translate>
		  		    	</em>
		  		    </td>
		  		</tr>
	  			</table>
			</div>
		</div>
	</div>
</div>

<div class="clr"></div>

<input type="hidden" name="vars[lang]" value="{VAR_LANG}" />
<input type="hidden" id="utfsupport" name="vars[DButfSupport]" value="" />
<input type="hidden" name="vars[DBcreated]" value="{VAR_DBCREATED}" />
<input type="hidden" name="task" value="" />
</form>
<form action="includes/jajax.php" id="mainForm" onsubmit="ajform:getReturnData();">
	<input type="hidden" id="theType" name="type" value="" />
	<input type="hidden" id="theHost" name="host" value="" />
	<input type="hidden" id="theUser" name="user" value="" />
	<input type="hidden" id="thePass" name="pass" value="" />
	<input type="hidden" name="task" value="dbcollate" />
</form>

